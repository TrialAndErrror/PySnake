<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Title</title>
  <link rel="stylesheet" href="https://pyscript.net/alpha/pyscript.css"/>
  <script defer src="https://pyscript.net/alpha/pyscript.js"></script>
</head>
<style>
  canvas {
    border-width: 5px;
    border-color: red;
    margin: 25px;
  }
  button {
    background-color: #008CBA;
    color: white;
    padding: 10px;
  }
</style>
<body>
<h2>The Snake Case</h2>
<button id="start" type="button">Start Game</button>
<!-- <button id="start" type="button" pysB-onClick="run_game">Start Game</button> -->
<canvas id="gameCanvas" width="1200" height="600"></canvas>
<!--<button id="restart" value="True" title="restart" pys-onClick="restart_game">restart</button>-->
<py-script>
  from js import document
  import asyncio
  from pyodide import create_proxy

  snakeboard = document.getElementById("gameCanvas")
  snakeboard_ctx = snakeboard.getContext("2d")


  def draw_snake_part(snake_part: dict):
    snakeboard_ctx.fillStyle = 'lightblue'
    snakeboard_ctx.strokeStyle = 'darkblue'
    snakeboard_ctx.fillRect(snake_part['x'], snake_part['y'], 50, 50)
    snakeboard_ctx.strokeRect(snake_part['x'], snake_part['y'], 50, 50)


  def draw_snake(snake):
    snakeboard_ctx.clearRect(0, 0, snakeboard.width, snakeboard.height)
    for segment in snake:
      draw_snake_part(segment)


  def clear_square(prev):
    snakeboard_ctx.clearRect(prev['x'], prev['y'], 50, 50 )


  def move_snake(snake: list, head_change: dict):
    print(snake)
    head: dict = {'x': snake[0]['x'] + head_change['x'], 'y': snake[0]['y'] + head_change['y']}
    snake.insert(0, head)
    prev = snake.pop()
    print(snake)
    return snake, prev

  async def time_out(sleep: float = 1):
    timeout = await asyncio.sleep(sleep)
    print('one second passed')

  async def run_game(speed: float = 1.0):

    snake: list = [
        {'x': 500, 'y': 200},
        {'x': 450, 'y': 200},
        {'x': 400, 'y': 200},
        {'x': 350, 'y': 200},
        {'x': 300, 'y': 200}
      ]

    while True:
      draw_snake(snake)
      await time_out(1)
      snake, prev = move_snake(snake, {'x': 50, 'y': 0})
      clear_square(prev)
      print(snake)

  startButton = document.getElementById('start')
  startButton.addEventListener('click', create_proxy(run_game))

</py-script>
</body>
</html>


<!-- <py-script>
  snakeboard = Element("gameCanvas")
  snakeboard_ctx = snakeboard.getContext("2d")

</py-script> -->
